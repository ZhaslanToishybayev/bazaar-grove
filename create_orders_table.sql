CREATE TABLE IF NOT EXISTS orders (id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), user_id UUID NOT NULL, status TEXT NOT NULL, payment_status TEXT, total_amount DECIMAL NOT NULL, tracking_number TEXT, shipping_address TEXT, shipping_city TEXT, shipping_postal_code TEXT, shipping_country TEXT, phone TEXT, email TEXT, stripe_session_id TEXT, created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(), updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()); CREATE TABLE IF NOT EXISTS order_items (id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE, product_id UUID NOT NULL, product_name TEXT NOT NULL, product_price DECIMAL NOT NULL, quantity INTEGER NOT NULL, created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(), updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()); CREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id); CREATE INDEX IF NOT EXISTS idx_orders_stripe_session_id ON orders(stripe_session_id); CREATE INDEX IF NOT EXISTS idx_order_items_order_id ON order_items(order_id);
