# Миграции базы данных Supabase

Этот каталог содержит SQL-скрипты для миграции базы данных Supabase.

## Решение проблемы с отправкой сообщений

Если вы видите ошибку при отправке сообщений через контактную форму, это связано с тем, что необходимые таблицы еще не созданы в базе данных. Для решения этой проблемы:

1. Выполните миграции в следующем порядке:
   - `03_create_admins_table.sql` - создание таблицы администраторов
   - `02_create_messages_table.sql` - создание таблицы для сообщений

2. Добавьте вашего пользователя как администратора:
   ```sql
   -- Посмотрите ID вашего пользователя
   SELECT id FROM auth.users WHERE email = 'ваш_email@example.com';
   
   -- Вставьте ID как администратора
   INSERT INTO admins (user_id) VALUES ('полученный_id_пользователя');
   ```

После этого контактная форма должна работать корректно.

## Как выполнить миграцию

1. Войдите в панель управления Supabase (https://app.supabase.com)
2. Выберите ваш проект
3. Перейдите в раздел "SQL Editor"
4. Создайте новый запрос
5. Скопируйте содержимое файла миграции в редактор запросов
6. Выполните запрос

## Список миграций

1. `01_create_wishlist_table.sql` - создание таблицы для хранения избранных товаров
2. `03_create_admins_table.sql` - создание таблицы администраторов (**выполните эту миграцию перед `02_create_messages_table.sql`**)
3. `02_create_messages_table.sql` - создание таблицы для хранения сообщений из контактной формы

## Порядок выполнения миграций

**Важно:** Миграции должны выполняться в следующем порядке:
1. `01_create_wishlist_table.sql`
2. `03_create_admins_table.sql`
3. `02_create_messages_table.sql`

Это связано с тем, что таблица `messages` имеет зависимость от таблицы `admins`.

## Первоначальная настройка таблицы администраторов

После создания таблицы `admins`, вам необходимо добавить в неё первого администратора. Это можно сделать с помощью следующего SQL-запроса:

```sql
-- Замените YOUR_USER_ID на ID вашего пользователя из auth.users
INSERT INTO admins (user_id) VALUES ('YOUR_USER_ID');
```

Чтобы узнать ID вашего пользователя, выполните запрос:
```sql
SELECT id FROM auth.users WHERE email = 'ваш_email@пример.com';
```

## Примечания по таблицам

### Таблица `messages`
- Любой пользователь может отправлять сообщения
- Только администраторы могут просматривать, обновлять и удалять сообщения

### Таблица `admins`
- Только администраторы могут просматривать, добавлять, изменять и удалять других администраторов
- Первый администратор должен быть добавлен напрямую через SQL

## Важно

Убедитесь, что таблицы были созданы правильно, и политики безопасности применены. Вы можете проверить это в разделе "Database" > "Tables" в панели управления Supabase. 